---
    title: "预习报告"
    author: [PB20061372 朱云沁]
    date: "2022-10-14"
---

# 实验二: 基础管理与以太交换

## 基础管理

### 首次登录设备

打开 eNSP 软件, 新建拓扑, 添加一台 PC 终端设备 PC1 与一台 S5700 交换机设备 LSW1. 用 CTL 连接 PC1 的 RS232 口与 LSW1 的 Console 口, 如下图所示.

![图1](img/1.png)

启动 PC1 与 LSW1, 打开 PC1 串口设置, 以缺省参数连接, 进入 LSW1 的终端界面, 如下图所示.

![图2](img/2.png)

### 系统常用配置

#### 帮助功能和命令自动补全

在任一命令视图下, 输入 `?` 查看完全帮助, 如下图所示.

![图3](img/3.png)

在接口视图下, 输入 `authentication-mode ?`, 列出全部关键字及简单描述, 如下图所示.

![图4](img/4.png)

在用户视图下, 输入 `display b?`, 列出命令以该字符串开头的所有关键字, 如下图所示.

![图5](img/5.png)

输入命令的某个关键字的前几个字母, 按下 `<tab>` 键用于自动补全, 步骤略.

#### 查看系统信息

执行 `display version` 命令, 显示版本信息, 如下图所示.

![图6](img/6.png)

#### 进入视图

执行 `system-view` 命令, 进入系统视图, 如下图所示.

![图7](img/7.png)

#### 修改设备名称

在系统视图下, 执行 `sysname` 命令, 将设备名称设置为 `PB20061372`, 如下图所示.

![图8](img/8.png)

### 保存恢复配置

#### 保存设备配置

输入 `quit` 回到用户视图, 执行 `save` 命令, 将配置文件保存至 `PB20061372.cfg`, 如下图所示.

![图9](img/9.png)

执行 `dir` 查看 flash 目录, 执行 `more` 命令查看配置文件内容, 如下图所示.

![图10](img/10.png)

#### 备份设备配置

执行 `copy` 命令, 在 flash 中备份配置文件, 如下图所示.

![图11](img/11.png)

执行 `dir` 命令, 发现备份文件大小与原文件大小一致, 如下图所示.

![图12](img/12.png)

#### 恢复设备配置

假定上一个同学配置的设备名称为 `PB20061268`. 从存储器拷贝配置文件至交换机 flash, 步骤略.

执行 `startup saved-configuration` 命令, 设置重启配置文件为 `PB20061372.cfg`, 然后执行 `roboot fast` 快速重启设备, 如下图所示.

![图13](img/13.png)

重启后, 执行 `display saved-configuration` 命令, 发现配置文件已恢复, 如下图所示.

![图14](img/14.png)

## 以太交换

### 广播转发

在 eNSP 中连接拓扑, 如下图所示. 启动各 PC 与交换机.

![图15](img/15.png)

假定使用 6 号交换机, 由于本人学号为 PB20061372, GID 号为 2202010441, 应当将 PC1 的 IP 地址配置为 `10.60.72.41`, 如下图所示.

![图16](img/16.png)

简单考虑, 将 PC2, PC3 的 IP 地址分别配置为 `10.10.10.2` 和 `10.10.10.3`.

在 PC1 终端中, 执行 `ping` 命令, 发现 PC2, PC3 均可 `ping` 通, 如下图所示.

![图17](img/17.png)

PC2 可以 `ping` 通 PC1、PC3, PC3 可以 `ping` 通 PC1、PC2, 图略.

在 LSW1 终端中, 执行 `display mac-address` 命令, 发现交换机学习到了 PC1, PC2, PC3 的 MAC 地址, 如下图所示.

![图18](img/18.png)

PC1 的端口为 GE 0/0/1, PC2、PC3 的端口为 GE 0/0/2, VLAN均为1, 符合预期.

LSW2、LSW3 同样学习到了 PC1, PC2, PC3 的 MAC 地址, 图略.****

### VLAN 隔离与互通

#### VLAN 隔离

在 LSW1 终端中, 进入系统视图, 开启 VLAN 资源. 进入 GE 0/0/1 的接口视图, 配置连接类型为 `access`, 缺省 VLAN 为 10; 进入 GE 0/0/2 的接口视图, 配置连接类型为 `trunk`, 允许通过 VLAN 10.

上述操作的输入输出如下图所示.

![图19](img/19.png)

在 LSW1 终端中查看VLAN配置结果, 如下图所示.

![图20](img/20.png)

对 LSW2 和 LSW3 作类似配置. 其中, LSW2 的 Access 端口配置为 VLAN 20, Trunk 端口 GE 0/0/2 与 GE 0/0/3 分别配置为 VLAN 10 和 VLAN 30; LSW3 的 Access 端口配置为 VLAN 30, Trunk 端口配置为 VLAN 30, 过程略.

发现 PC1 无法 `ping` 通 PC3, 图略. PC3 无法 `ping` 通 PC1, 如下图所示.

![图21](img/21.png)

#### VLAN 互通

允许 LSW1 的 Trunk 端口和 LSW2 的 GE 0/0/2 端口通过 VLAN 10、20; 允许 LSW2 的 GE 0/0/3 端口和 LSW3 的 Trunk 端口通过 VLAN 20、30. 此时, LSW2 的配置情况如下.

![图22](img/22.png)

将 LSW2 的 Access 端口配置修改为 VLAN 10, 发现 PC2 可以与 PC1 互通, 但无法与 PC3 互通. 如下图所示.

![图23](img/23.png)
![图24](img/24.png)
![图25](img/25.png)

LSW1、LSW2 均在 VLAN 10 和预期端口学习到了 PC1、PC2 的 MAC 地址.

在PC3 尝试 `ping` PC2 后, LSW2 学习到了 PC3 的 MAC 地址, 对应 VLAN 30 和 GE 0/0/3, 符合预期.

LSW3 仅在 Access 端口学习到了 PC3 的 MAC 地址.

![图26](img/26.png)
![图27](img/27.png)
![图28](img/28.png)

在 LSW1 的 Trunk 端口 (或 LSW2 的 GE 0/0/2) 上执行 `undo port trunk allow-pass vlan 10`, 则 PC1、PC2 无法互通, LSW2 无法学习到 PC1 的 MAC (或 LSW1 无法学习到 PC2 的 MAC); 在 LSW3 的 Trunk 端口 (或 LSW2 的 GE 0/0/3) 上执行 `undo port trunk allow-pass vlan 30`, 则 LSW2 无法学习到 PC3 的 MAC (或 LSW3 无法学习到 PC2 的 MAC). 以修改 LSW2 的 GE 0/0/2 为例:

![图29](img/29.png)

将 LSW2 的 Access 端口配置修改为 VLAN 30, 发现可以与 PC3 互通而无法与 PC1 互通. 修改 Trunk 端口, 得到结论类似.

在 LSW2 的 Access 端口的三种情况下, PC1、PC3 始终无法互通.

# 实验三: IPv4 与路由

## IPv4 地址配置

在 eNSP 中连接拓扑, 如下图所示. 启动 PC1 ~ PC3, LSW1 ~ LSW3 和 R1.

![图30](img/30.png)

对 LSW1 作如下配置, 令其接 PC1 地址为 `10.10.10.1`, 接 R1 地址为 `100.10.10.1`, 子网掩码为 `255.255.255.0`.

![图31](img/31.png)

对 R1 作如下配置, 令其接 LSW1 地址为 `100.10.10.2`, 子网掩码为 `255.255.255.0`.

![图32](img/32.png)

将 PC1 的 IPv4 地址配置为 `10.10.10.2` , 如下图所示.

![图33](img/33.png)

PC1 能够 `ping` 通 `10.10.10.1`, 如下图所示.

![图34](img/34.png)

LSW1 能够 `ping` 通 `100.10.10.2`, 如下图所示.

![图35](img/35.png)

## DHCP配置

对 LSW1 作如下配置, 令其开启 DHCP 服务, 在逻辑接口 Vlanif 10 上配置地址池, 令 `example.com` 为域名, 令 `10.1.3.1` 为 DNS 服务器地址.

![图36](img/36.png)

开启对 PC1 的 Ethernet 0/0/1 数据抓包, 设置 display filter 为 `dhcp`. 在 PC1 的设置中选定 IPv4 配置方式为 DHCP 并应用, 如下图所示.

![图37](img/37.png)

在 LSW1 中查看 VLAN 配置与 Vlanif 10 的地址池, 发现有 1 个地址被使用, 如下图所示.

![图38](img/38.png)

在 PC1 中执行 `ipconfig`, 发现动态分配的 IP 地址为 `10.10.10.254`, 子网掩码为 `255.255.255.0`, 网关为 `10.10.10.1`, DNS 服务器为 `10.1.3.1`, 符合预期.

![图39](img/39.png)

将 PC1 的 IPv4 地址重新设置为静态分配. 此时, 查看 Wireshark 中的抓包结果, 如下图所示.

![图40](img/40.png)

发现地址分配时的交互过程如下:

1. 客户端 PC1 发送 DHCP Discover 报文, 寻找 DHCP 服务器.
2. 服务器 LSW1 发送 DHCP Offer 报文, 提供 PC1 可用的地址.
3. 客户端 PC1 发送 DHCP Request 报文, 请求使用该地址.
4. 服务器 LSW1 发送 DHCP ACK 报文, 应答 PC1 的请求.

## 静态路由配置

对 R1 作如下配置, 设置逻辑接口 Loopback 0 的 IP 地址为 `200.10.70.1`. 设置 `10.10.10.0/24` 网段的下一跳地址为 `100.10.10.1`.

![图41](img/41.png)

对 LSW1 作如下配置, 设置 `200.10.70.0/24` 网段的下一跳地址为 `100.10.10.2`.

![图42](img/42.png)

此时, PC1 能够 `ping` 通 `200.10.70.1`, 如下图所示.

![图43](img/43.png)

上述 `ping` 的通信过程为:

1. PC1 发送请求报文, 目标 IP 地址为 `200.10.70.1`, 报文到达 LSW1.
2. 根据静态路由配置, LSW1 将报文转发至 R1 接 LSW1 的地址 `100.10.10.2`, 因此报文到达 R1.
3. R1 的 Loopback 0 接口地址即为 `200.10.70.1`, 因此 R1 接受请求.
4. R1 发送响应报文, 目标 IP 地址为 `10.10.10.254`.
5. 根据静态路由配置, R1 将报文转发至 LSW1 接 R1 的地址 `100.10.10.1`, 因此报文到达 LSW1.
6. LSW1 的 Vlanif 10 接口网段为 `10.10.10.0/24`, 因此报文到达 PC1.

根据路由表中的下一跳地址, 交换机或路由器查找下一个目的 MAC 地址, 重新封装数据帧, 从而将报文转发至下一个网络设备.

## OSPF 配置

首先, 禁用 DHCP 并撤回静态路由配置, 过程略.

对 LSW1 作如下配置. 启用 OSPF, 以地址 `200.10.10.1` 作为路由器标识. 至 R1 网段上使能 OSPF, 至 PC1 网段则引入外部路由处理.

![图44](img/44.png)

对 LSW2、LSW3 作类似配置, 路由器标识分别为 `200.10.20.1`、`200.10.30.1`

对 R1 作如下配置. 启用 OSPF, 以地址 `200.10.70.1` 作为路由器标识. 分别在至 LSW1、LSW2、LSW3 网段上使能 OSPF.

![图45](img/45.png)

将 PC1、PC2、PC3 的 IPv4 地址分别设置为 `10.10.10.2`、`10.10.20.2`、`10.10.30.2`, 并配置子网掩码、网关. 以 PC1 为例,

![图46](img/46.png)

PC1 能够 `ping` 通 PC2、PC3, 如下图所示.

![图47](img/47.png)

R1 上 OSPF 已建立, 路由如下图所示.

![图48](img/48.png)

R1 的路由表如下图所示.

![图49](img/49.png)

LSW1 上 OSPF 已建立, 路由如下图所示.

![图50](img/50.png)

LSW1 的路由表如下图所示.

![图51](img/51.png)

LSW2、LSW3 路由表类似, 图略.

## BGP 配置

同样地, 按上一节的标准, 配置 R2、LSW4、LSW5、LSW6、PC4、PC5、PC6, 过程略.

配置 R1、R2 间接口 IP 地址, 如下图所示.

![图52](img/52.png)
![图53](img/53.png)

对 R1 作如下配置. 启用 BGP, 以地址 `200.100.70.1` 为路由器标识. BGP 引入直连路由、OSPF 路由; OSPF 引入 BGP 路由.

![图54](img/54.png)

对 R2 作类似配置. 启用 BGP, 以地址 `200.100.70.2` 为路由器标识, 引入外部路由.

![图55](img/55.png)

查看 R2 的路由表, 如下图所示. R1 的路由表类似, 图略.

![图56](img/56.png)

查看 LSW4 的路由表, 如下图所示. LSW5、LSW6 路由表类似, 图略.

![图57](img/57.png)

PC1 能 `ping` 通 PC4、PC5、PC6, 如下图所示.

![图58](img/58.png)

PC4 能 `ping` 通 PC1、PC2、PC3, 如下图所示.

![图59](img/59.png)

至此, eNSP 仿真实验全部完成.
